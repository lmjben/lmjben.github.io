(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{166:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._m(1),a("p",[t._v("在运行时完成模块加载。")]),t._m(2),a("p",[t._v("自动采用严格模式。\nes6可以在编译时完成模块加载。")]),t._m(3),a("p",[t._v("用于规定模块的对外接口。")]),a("p",[t._v("export命令规定的是对外的接口，必须与模块内部的变量建立一一对应关系。")]),t._m(4),a("p",[t._v("export 命令可以出现在模块的任何位置，只要处于模块顶层就可以。如果处于块级作用域，就会报错（违背了静态化初衷）。")]),t._m(5),a("p",[t._v("用于输入其他模块提供的功能。")]),a("p",[t._v("import 命令具有提升效果，会提升到整个模块的头部并首先执行。\n本质是import命令式便一阶段执行的，在代码运行之前。")]),a("p",[t._v("由于import是静态执行的，不能使用表达式和变量，只有在运行时才能得到结果的语法结构。")]),t._m(6),a("p",[t._v("多次重复执行同一句import语句，那么只会执行一次。")]),t._m(7),t._m(8),a("p",[t._v("整体模块加载所在的对象应该是可以静态分析的，所以不允许运行时改变")]),t._m(9),t._m(10),a("p",[t._v("本质上，export default 就是输出一个叫做default 的变量或方法。")]),t._m(11),t._m(12),a("p",[t._v("动态加载模块，可以在条件运算，表达式中使用。")]),a("p",[t._v("返回一个promise对象。\nimport() 类似于node的require方法，区别主要是，前者是异步加载，后者是同步加载。")]),t._m(13),t._m(14),a("p",[t._v("0、传统的script标签")]),t._m(15),a("p",[t._v("1、使用浏览器script标签")]),t._m(16),a("p",[t._v("代码是在模块作用域之中云进行，而不是在全局作用域中运行。")]),t._m(17),t._m(18),a("p",[t._v("es6模块是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块。\nes6输入的模块变量知识一个“符号链接”，所以这个变量是制度的，对他重新赋值会报错。")]),t._m(19),t._m(20),t._m(21),t._m(22),a("p",[t._v("commonjs模块循环加载，值输出已执行的部分，还未执行的额部分不会输出。")]),t._m(23),a("p",[t._v("上面代码之中，b.js执行到第二行，就会去加载a.js，这时，就发生了“循环加载”。系统会去a.js模块对应对象的exports属性取值，可是因为a.js还没有执行完，从exports属性只能取回已经执行的部分，而不是最后的值。\na.js已经执行的部分，只有一行。\n因此，对于b.js来说，它从a.js只输入一个变量done，值为false。\n然后，b.js接着往下执行，等到全部执行完毕，再把执行权交还给a.js。于是，a.js接着往下执行，直到执行完毕。")]),t._m(24),a("p",[t._v("es6加载的变量都是动态引用其所在模块的。只要应用存在，代码就能执行。")]),t._m(25),a("p",[t._v("z")]),a("p",[t._v("参考资料：")]),a("p",[a("a",{attrs:{href:"http://es6.ruanyifeng.com/#docs/module-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("module加载的实现"),a("OutboundLink")],1)])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"js-module-语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js-module-语法","aria-hidden":"true"}},[this._v("#")]),this._v(" js module 语法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"commonjs-模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#commonjs-模块","aria-hidden":"true"}},[this._v("#")]),this._v(" commonjs 模块")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"es6-模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es6-模块","aria-hidden":"true"}},[this._v("#")]),this._v(" es6 模块")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"export-模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#export-模块","aria-hidden":"true"}},[this._v("#")]),this._v(" export 模块")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 报错")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 报错")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" m "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 正确")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" m "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 正确")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" m "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("m"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 正确")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" n"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("n "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" m"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"import-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#import-命令","aria-hidden":"true"}},[this._v("#")]),this._v(" import 命令")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'a'")]),a("span",{attrs:{class:"token operator"}},[t._v("+")]),a("span",{attrs:{class:"token string"}},[t._v("'bcd'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'my_module'")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("//执行一次")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("a"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'my_module'")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("b"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'my_module'")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 执行一次")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'lodash'")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'lodash'")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"模块的整体加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模块的整体加载","aria-hidden":"true"}},[this._v("#")]),this._v(" 模块的整体加载")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" xxx "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'my_module'")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 报错")]),t._v("\nxxx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'123'")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"export-default-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#export-default-命令","aria-hidden":"true"}},[this._v("#")]),this._v(" export default 命令")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("MyClass")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" MyClass"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 相等于")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MyClass "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"import-方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#import-方法","aria-hidden":"true"}},[this._v("#")]),this._v(" import() 方法")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("import")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'my_module'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"模块的加载实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模块的加载实现","aria-hidden":"true"}},[this._v("#")]),this._v(" 模块的加载实现")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 下载完就执行")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"application/javascript"')]),t._v(" scr"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"foo.js"')]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 整个页面正常渲染完才会执行")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"application/javascript"')]),t._v(" scr"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"foo2.js"')]),t._v(" defer"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),t._v(" scr"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"foo.js"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"es6模块和commonjs模块的差异"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es6模块和commonjs模块的差异","aria-hidden":"true"}},[this._v("#")]),this._v(" es6模块和commonjs模块的差异")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("commonjs模块输出的是一个值得复制，es6模块输出的是值的引用")]),s("li",[this._v("commonjs模块是运行时加载，es6模块是编译时输出接口")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("a"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'my_module'")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 报错")]),t._v("\na"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("porp "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'123'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"模块加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模块加载","aria-hidden":"true"}},[this._v("#")]),this._v(" 模块加载")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./foo'")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//依次寻找")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("package")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'foo'")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//依次寻找")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("packagejson"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token comment"}},[t._v("//向上一级继续寻找")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token comment"}},[t._v("//继续向上一级寻找")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"循环加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#循环加载","aria-hidden":"true"}},[this._v("#")]),this._v(" 循环加载")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// a.js")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'在 a.js 之中，b.done = %j'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a.js 执行完毕'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// b.js")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'在 b.js 之中，a.done = %j'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'b.js 执行完毕'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("在 b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 之中，a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nb"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 执行完毕\n在 a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 之中，b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\na"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 执行完毕\n在 main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 之中"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n\nSearch\n目录\n前言\nECMAScript "),a("span",{attrs:{class:"token number"}},[t._v("6")]),t._v("简介\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" 和 "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" 命令\n变量的解构赋值\n字符串的扩展\n正则的扩展\n数值的扩展\n函数的扩展\n数组的扩展\n对象的扩展\nSymbol\nSet 和 Map 数据结构\nProxy\nReflect\nPromise 对象\nIterator 和 "),a("span",{attrs:{class:"token keyword"}},[t._v("for")]),a("span",{attrs:{class:"token operator"}},[t._v("...")]),a("span",{attrs:{class:"token keyword"}},[t._v("of")]),t._v(" 循环\nGenerator 函数的语法\nGenerator 函数的异步应用\n"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" 函数\nClass 的基本语法\nClass 的继承\nDecorator\nModule 的语法\nModule 的加载实现\n编程风格\n读懂规格\nArrayBuffer\n最新提案\n参考链接\n其他\n源码\n修订历史\n反馈意见\nModule 的加载实现\n浏览器加载\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块与 CommonJS 模块的差异\nNode 加载\n循环加载\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块的转码\n上一章介绍了模块的语法，本章介绍如何在浏览器和 Node 之中加载 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块，以及实际开发中经常遇到的一些问题（比如循环加载）。\n\n浏览器加载\n传统方法\n"),a("span",{attrs:{class:"token constant"}},[t._v("HTML")]),t._v(" 网页中，浏览器通过"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("标签加载 JavaScript 脚本。\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),a("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v(" 页面内嵌的脚本 "),a("span",{attrs:{class:"token operator"}},[t._v("--")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"application/javascript"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// module code")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),a("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v(" 外部脚本 "),a("span",{attrs:{class:"token operator"}},[t._v("--")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"application/javascript"')]),t._v(" src"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"path/to/myModule.js"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n上面代码中，由于浏览器脚本的默认语言是 JavaScript，因此type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"application/javascript"')]),t._v("可以省略。\n\n默认情况下，浏览器是同步加载 JavaScript 脚本，即渲染引擎遇到"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("标签就会停下来，等到执行完脚本，再继续向下渲染。如果是外部脚本，还必须加入脚本下载的时间。\n\n如果脚本体积很大，下载和执行的时间就会很长，因此造成浏览器堵塞，用户会感觉到浏览器“卡死”了，没有任何响应。这显然是很不好的体验，所以浏览器允许脚本异步加载，下面就是两种异步加载的语法。\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"path/to/myModule.js"')]),t._v(" defer"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"path/to/myModule.js"')]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n上面代码中，"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("标签打开defer或"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v("属性，脚本就会异步加载。渲染引擎遇到这一行命令，就会开始下载外部脚本，但不会等它下载和执行，而是直接执行后面的命令。\n\ndefer与"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v("的区别是：defer要等到整个页面在内存中正常渲染结束（"),a("span",{attrs:{class:"token constant"}},[t._v("DOM")]),t._v(" 结构完全生成，以及其他脚本执行完成），才会执行；"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v("一旦下载完，渲染引擎就会中断渲染，执行这个脚本以后，再继续渲染。一句话，defer是“渲染完再执行”，"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v("是“下载完就执行”。另外，如果有多个defer脚本，会按照它们在页面出现的顺序加载，而多个"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v("脚本是不能保证加载顺序的。\n\n加载规则\n浏览器加载 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块，也使用"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("标签，但是要加入type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),t._v("属性。\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),t._v(" src"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"./foo.js"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n上面代码在网页中插入一个模块foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，由于type属性设为module，所以浏览器知道这是一个 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块。\n\n浏览器对于带有type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),t._v("的"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("，都是异步加载，不会造成堵塞浏览器，即等到整个页面渲染完，再执行模块脚本，等同于打开了"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("标签的defer属性。\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),t._v(" src"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"./foo.js"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),a("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v(" 等同于 "),a("span",{attrs:{class:"token operator"}},[t._v("--")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),t._v(" src"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"./foo.js"')]),t._v(" defer"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n如果网页有多个"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("，它们会按照在页面出现的顺序依次执行。\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("标签的"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v("属性也可以打开，这时只要加载完成，渲染引擎就会中断渲染立即执行。执行完成后，再恢复渲染。\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),t._v(" src"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"./foo.js"')]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n一旦使用了"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v("属性，"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("就不会按照在页面出现的顺序执行，而是只要该模块加载完成，就执行该模块。\n\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块也允许内嵌在网页中，语法行为与加载外部脚本完全一致。\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"module"')]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" utils "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"./utils.js"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// other code")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n对于外部的模块脚本（上例是foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js），有几点需要注意。\n\n代码是在模块作用域之中运行，而不是在全局作用域运行。模块内部的顶层变量，外部不可见。\n模块脚本自动采用严格模式，不管有没有声明use strict。\n模块之中，可以使用"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令加载其他模块（"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js后缀不可省略，需要提供绝对 "),a("span",{attrs:{class:"token constant"}},[t._v("URL")]),t._v(" 或相对 "),a("span",{attrs:{class:"token constant"}},[t._v("URL")]),t._v("），也可以使用"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v("命令输出对外接口。\n模块之中，顶层的"),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("关键字返回undefined，而不是指向window。也就是说，在模块顶层使用"),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("关键字，是无意义的。\n同一个模块如果加载多次，将只执行一次。\n下面是一个示例模块。\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" utils "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'https://example.com/js/utils.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" window"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("//false")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" undefined"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n利用顶层的"),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("等于undefined这个语法点，可以侦测当前代码是否在 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块之中。\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isNotModuleScript "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" undefined"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块与 CommonJS 模块的差异\n讨论 Node 加载 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块之前，必须了解 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块与 CommonJS 模块完全不同。\n\n它们有两个重大差异。\n\nCommonJS 模块输出的是一个值的拷贝，"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块输出的是值的引用。\nCommonJS 模块是运行时加载，"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块是编译时输出接口。\n第二个差异是因为 CommonJS 加载的是一个对象（即module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports属性），该对象只有在脚本运行完才会生成。而 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成。\n\n下面重点解释第一个差异。\n\nCommonJS 模块输出的是值的拷贝，也就是说，一旦输出一个值，模块内部的变化就影响不到这个值。请看下面这个模块文件lib"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js的例子。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// lib.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" counter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("incCounter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  counter"),a("span",{attrs:{class:"token operator"}},[t._v("++")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  incCounter"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" incCounter"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面代码输出内部变量counter和改写这个变量的内部方法incCounter。然后，在main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js里面加载这个模块。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" mod "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./lib'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mod"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("// 3")]),t._v("\nmod"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("incCounter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mod"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 3")]),t._v("\n上面代码说明，lib"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js模块加载以后，它的内部变化就影响不到输出的mod"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("counter了。这是因为mod"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("counter是一个原始类型的值，会被缓存。除非写成一个函数，才能得到内部变动后的值。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// lib.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" counter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("incCounter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  counter"),a("span",{attrs:{class:"token operator"}},[t._v("++")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("counter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" counter\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  incCounter"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" incCounter"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面代码中，输出的counter属性实际上是一个取值器函数。现在再执行main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，就可以正确读取内部变量counter的变动了。\n\n$ node main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),a("span",{attrs:{class:"token number"}},[t._v("4")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块的运行机制与 CommonJS 不一样。"),a("span",{attrs:{class:"token constant"}},[t._v("JS")]),t._v(" 引擎对脚本静态分析的时候，遇到模块加载命令"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("，就会生成一个只读引用。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。换句话说，"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 的"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("有点像 Unix 系统的“符号连接”，原始值变了，"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("加载的值也会跟着变。因此，"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块。\n\n还是举上面的例子。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// lib.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" counter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("incCounter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  counter"),a("span",{attrs:{class:"token operator"}},[t._v("++")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" incCounter "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./lib'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 3")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("incCounter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 4")]),t._v("\n上面代码说明，"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块输入的变量counter是活的，完全反应其所在模块lib"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js内部的变化。\n\n再举一个出现在"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v("一节中的例子。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// m1.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'bar'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'baz'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("500")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// m2.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./m1.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("500")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面代码中，m1"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js的变量foo，在刚加载时等于bar，过了 "),a("span",{attrs:{class:"token number"}},[t._v("500")]),t._v(" 毫秒，又变为等于baz。\n\n让我们看看，m2"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js能否正确读取这个变化。\n\n$ babel"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("node m2"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n\nbar\nbaz\n上面代码表明，"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块不会缓存运行结果，而是动态地去被加载的模块取值，并且变量总是绑定其所在的模块。\n\n由于 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 输入的模块变量，只是一个“符号连接”，所以这个变量是只读的，对它进行重新赋值会报错。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// lib.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" obj "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" obj "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./lib'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nobj"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prop "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("123")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// OK")]),t._v("\nobj "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// TypeError")]),t._v("\n上面代码中，main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js从lib"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js输入变量obj，可以对obj添加属性，但是重新赋值就会报错。因为变量obj指向的地址是只读的，不能重新赋值，这就好比main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js创造了一个名为obj的"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v("变量。\n\n最后，"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v("通过接口，输出的是同一个值。不同的脚本加载这个接口，得到的都是同样的实例。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// mod.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("C")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sum "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sum "),a("span",{attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("show")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sum"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" c "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("C")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面的脚本mod"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，输出的是一个"),a("span",{attrs:{class:"token constant"}},[t._v("C")]),t._v("的实例。不同的脚本加载这个模块，得到的都是同一个实例。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// x.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("c"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./mod'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nc"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// y.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("c"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./mod'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nc"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("show")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./x'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./y'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n现在执行main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，输出的是"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("。\n\n$ babel"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("node main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("\n这就证明了x"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js和y"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js加载的都是"),a("span",{attrs:{class:"token constant"}},[t._v("C")]),t._v("的同一个实例。\n\nNode 加载\n概述\nNode 对 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块的处理比较麻烦，因为它有自己的 CommonJS 模块格式，与 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块格式是不兼容的。目前的解决方案是，将两者分开，"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块和 CommonJS 采用各自的加载方案。\n\nNode 要求 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块采用"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs后缀文件名。也就是说，只要脚本文件里面使用"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("或者"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v("命令，那么就必须采用"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs后缀名。require命令不能加载"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs文件，会报错，只有"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令才可以加载"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs文件。反过来，"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs文件里面也不能使用require命令，必须使用"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("。\n\n目前，这项功能还在试验阶段。安装 Node v8"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("5.0")]),t._v(" 或以上版本，要用"),a("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("experimental"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("modules参数才能打开该功能。\n\n$ node "),a("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("experimental"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("modules my"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs\n为了与浏览器的"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("加载规则相同，Node 的"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs文件支持 "),a("span",{attrs:{class:"token constant"}},[t._v("URL")]),t._v(" 路径。\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./foo?query=1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 加载 ./foo 传入参数 ?query=1")]),t._v("\n上面代码中，脚本路径带有参数"),a("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v("query"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("，Node 会按 "),a("span",{attrs:{class:"token constant"}},[t._v("URL")]),t._v(" 规则解读。同一个脚本只要参数不同，就会被加载多次，并且保存成不同的缓存。由于这个原因，只要文件名中含有"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("、"),a("span",{attrs:{class:"token operator"}},[t._v("%")]),t._v("、#、"),a("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v("等特殊字符，最好对这些字符进行转义。\n\n目前，Node 的"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令只支持加载本地模块（file"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("协议），不支持加载远程模块。\n\n如果模块名不含路径，那么"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令会去node_modules目录寻找这个模块。\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'baz'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'abc/123'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n如果模块名包含路径，那么"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令会按照路径去寻找这个名字的脚本文件。\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'file:///etc/config/app.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./foo'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./foo?search'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'../bar'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'/baz'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n如果脚本文件省略了后缀名，比如"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./foo'")]),t._v("，Node 会依次尝试四个后缀名："),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs、"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js、"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json、"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("node。如果这些脚本文件都不存在，Node 就会去加载"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("package")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json的main字段指定的脚本。如果"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("package")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json不存在或者没有main字段，那么就会依次加载"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mjs、"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js、"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json、"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("foo"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("node。如果以上四个文件还是都不存在，就会抛出错误。\n\n最后，Node 的"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令是异步加载，这一点与浏览器的处理方法相同。\n\n内部变量\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块应该是通用的，同一个模块不用修改，就可以用在浏览器环境和服务器环境。为了达到这个目标，Node 规定 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块之中不能使用 CommonJS 模块的特有的一些内部变量。\n\n首先，就是"),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("关键字。"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块之中，顶层的"),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("指向undefined；CommonJS 模块的顶层"),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("指向当前模块，这是两者的一个重大差异。\n\n其次，以下这些顶层变量在 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块之中都是不存在的。\n\narguments\nrequire\nmodule\nexports\n__filename\n__dirname\n如果你一定要使用这些变量，有一个变通方法，就是写一个 CommonJS 模块输出这些变量，然后再用 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块加载这个 CommonJS 模块。但是这样一来，该 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块就不能直接用于浏览器环境了，所以不推荐这样做。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// expose.js")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// use.mjs")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" expose "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./expose.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" expose"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面代码中，expose"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js是一个 CommonJS 模块，输出变量__dirname，该变量在 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块之中不存在。"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块加载expose"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，就可以得到__dirname。\n\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块加载 CommonJS 模块\nCommonJS 模块的输出都定义在module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports这个属性上面。Node 的"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令加载 CommonJS 模块，Node 会自动将module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports属性，当作模块的默认输出，即等同于"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" xxx。\n\n下面是一个 CommonJS 模块。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// a.js")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'world'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 等同于")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'world'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令加载上面的模块，module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports会被视为默认输出，即"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令实际上输入的是这样一个对象"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("。\n\n所以，一共有三种写法，可以拿到 CommonJS 模块的module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 写法一")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" baz "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// baz = {foo: 'hello', bar: 'world'};")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 写法二")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" baz"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// baz = {foo: 'hello', bar: 'world'};")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 写法三")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" baz "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// baz = {")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get default() {return module.exports;},")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get foo() {return this.default.foo}.bind(baz),")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get bar() {return this.default.bar}.bind(baz)")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n上面代码的第三种写法，可以通过baz"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v("拿到module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports。foo属性和bar属性就是可以通过这种方法拿到了module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports。\n\n下面是一些例子。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// b.js")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// es.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" foo "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./b'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// foo = null;")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" bar "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./b'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// bar = { default:null };")]),t._v("\n上面代码中，es"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js采用第二种写法时，要通过bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v("这样的写法，才能拿到module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// c.js")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("two")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// es.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" foo "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./c'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("foo")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 2")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" bar "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./c'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nbar"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 2")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("bar")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// throws, bar is not a function")]),t._v("\n上面代码中，bar本身是一个对象，不能当作函数调用，只能通过bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v("调用。\n\nCommonJS 模块的输出缓存机制，在 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 加载方式下依然有效。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// foo.js")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("123")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_ "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面代码中，对于加载foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js的脚本，module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports将一直是"),a("span",{attrs:{class:"token number"}},[t._v("123")]),t._v("，而不会变成"),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),t._v("。\n\n由于 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块是编译时确定输出接口，CommonJS 模块是运行时确定输出接口，所以采用"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令加载 CommonJS 模块时，不允许采用下面的写法。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 不正确")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" readFile "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面的写法不正确，因为fs是 CommonJS 格式，只有在运行时才能确定readFile接口，而"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("命令要求编译时就确定这个接口。解决方法就是改为整体输入。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 正确的写法一")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" express "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'express'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" express"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 正确的写法二")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" express "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'express'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("express")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nCommonJS 模块加载 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块\nCommonJS 模块加载 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块，不能使用require命令，而要使用"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("函数。"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块的所有输出接口，会成为输入对象的属性。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// es.mjs")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'my-default'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// cjs.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" es_namespace "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./es.mjs'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// es_namespace = {")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get default() {")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//     ...")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   }")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// }")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("es_namespace"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// { bar:'my-default' }")]),t._v("\n上面代码中，"),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v("接口变成了es_namespace"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v("属性。\n\n下面是另一个例子。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// es.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token string"}},[t._v("'my-default'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" foo "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" bar "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("f")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("c")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// cjs.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" es_namespace "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./es'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// es_namespace = {")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get foo() {return foo;}")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get bar() {return foo;}")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get f() {return f;}")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//   get c() {return c;}")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n循环加载\n“循环加载”（circular dependency）指的是，a脚本的执行依赖b脚本，而b脚本的执行又依赖a脚本。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// a.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'b'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// b.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n通常，“循环加载”表示存在强耦合，如果处理不好，还可能导致递归加载，使得程序无法执行，因此应该避免出现。\n\n但是实际上，这是很难避免的，尤其是依赖关系复杂的大项目，很容易出现a依赖b，b依赖c，c又依赖a这样的情况。这意味着，模块加载机制必须考虑“循环加载”的情况。\n\n对于 JavaScript 语言来说，目前最常见的两种模块格式 CommonJS 和 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v("，处理“循环加载”的方法是不一样的，返回的结果也不一样。\n\nCommonJS 模块的加载原理\n介绍 "),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 如何处理“循环加载”之前，先介绍目前最流行的 CommonJS 模块格式的加载原理。\n\nCommonJS 的一个模块，就是一个脚本文件。require命令第一次加载该脚本，就会执行整个脚本，然后在内存生成一个对象。\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  id"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'...'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  loaded"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n上面代码就是 Node 内部加载模块后生成的一个对象。该对象的id属性是模块名，exports属性是模块输出的各个接口，loaded属性是一个布尔值，表示该模块的脚本是否执行完毕。其他还有很多属性，这里都省略了。\n\n以后需要用到这个模块的时候，就会到exports属性上面取值。即使再次执行require命令，也不会再次执行该模块，而是到缓存之中取值。也就是说，CommonJS 模块无论加载多少次，都只会在第一次加载时运行一次，以后再加载，就返回第一次运行的结果，除非手动清除系统缓存。\n\nCommonJS 模块的循环加载\nCommonJS 模块的重要特性是加载时执行，即脚本代码在require的时候，就会全部执行。一旦出现某个模块被"),a("span",{attrs:{class:"token string"}},[t._v('"循环加载"')]),t._v("，就只输出已经执行的部分，还未执行的部分不会输出。\n\n让我们来看，Node 官方文档里面的例子。脚本文件a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js代码如下。\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'在 a.js 之中，b.done = %j'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a.js 执行完毕'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面代码之中，a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js脚本先输出一个done变量，然后加载另一个脚本文件b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js。注意，此时a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js代码就停在这里，等待b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js执行完毕，再往下执行。\n\n再看b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js的代码。\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'在 b.js 之中，a.done = %j'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'b.js 执行完毕'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n上面代码之中，b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js执行到第二行，就会去加载a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，这时，就发生了“循环加载”。系统会去a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js模块对应对象的exports属性取值，可是因为a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js还没有执行完，从exports属性只能取回已经执行的部分，而不是最后的值。\n\na"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js已经执行的部分，只有一行。\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n因此，对于b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js来说，它从a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js只输入一个变量done，值为"),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("。\n\n然后，b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js接着往下执行，等到全部执行完毕，再把执行权交还给a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js。于是，a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js接着往下执行，直到执行完毕。我们写一个脚本main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，验证这个过程。\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'在 main.js 之中, a.done=%j, b.done=%j'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n执行main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，运行结果如下。\n\n$ node main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n\n在 b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 之中，a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nb"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 执行完毕\n在 a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 之中，b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\na"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 执行完毕\n在 main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js 之中"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n上面的代码证明了两件事。一是，在b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js之中，a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js没有执行完毕，只执行了第一行。二是，main"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js执行到第二行时，不会再次执行b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js，而是输出缓存的b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js的执行结果，即它的第四行。\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n总之，CommonJS 输入的是被输出值的拷贝，不是引用。\n\n另外，由于 CommonJS 模块遇到循环加载时，返回的是当前已经执行的部分的值，而不是代码全部执行后的值，两者可能会有差异。所以，输入变量的时候，必须非常小心。\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 安全的写法")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 危险的写法")]),t._v("\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("good")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("foo")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'good'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 使用的是 a.foo 的最新值")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("bad")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("foo")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'bad'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 使用的是一个部分加载时的值")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("上面代码中，如果发生循环加载，require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("foo的值很可能后面会被改写，改用require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("会更保险一点。\n\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块的循环加载\n"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 处理“循环加载”与 CommonJS 有本质的不同。"),a("span",{attrs:{class:"token constant"}},[t._v("ES6")]),t._v(" 模块是动态引用，如果使用"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v("从一个模块加载变量（即"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" foo "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'foo'")]),t._v("），那些变量不会被缓存，而是成为一个指向被加载模块的引用，需要开发者自己保证，真正取值的时候能够取到值。\n\n请看下面这个例子。\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// a.mjs")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("bar"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./b'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a.mjs'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'foo'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// b.mjs")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'b.mjs'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" bar "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'bar'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])}],!1,null,null,null);s.default=o.exports}}]);